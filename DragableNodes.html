<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>DragableNodes</title>
	</head>
	<body>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<style>
		html, body, svg {
			width: 100%;
			height: 100%;
		}
		</style>
		<svg></svg>
		
		<script>
			var nodes = [
				{
					"id":0,
					"type":"Node",
					"coordinate_x":100,
					"coordinate_y":100,
					"properties":{
						"name":"Node1"
					}
				},
				{
					"id":1,
					"type":"Node",
					"coordinate_x":200,
					"coordinate_y":200,
					"properties":{
						"name":"Node2"
					}
				},
			]
			
			var links = [
				{ source : 0, target : 1 },
			]
			
			var svg = d3.select('svg');
			
			var w = document.querySelector("body").clientWidth;
			var h = document.querySelector("body").clientHeight;
			
			// Force Layoutを設定
			var force = d3.layout.force()
			    .nodes(nodes)
			    .links(links)
			    .size([w, h])
				.gravity(0.1)
				.charge(-30)
				.friction(0.95)
				.linkDistance(220)
				.linkStrength(1);
			force.start();
			for (var i = 10000; i > 0; --i) force.tick();	
			
			var line = svg.selectAll("line")
				.data(links)
				.enter()
				.append("line")
				.attr({
					"stroke": "black",
					"x1":function(d){ return d.source.coordinate_x },
					"y1":function(d){ return d.source.coordinate_y },
					"x2":function(d){ return d.target.coordinate_x },
					"y2":function(d){ return d.target.coordinate_y },
				});
			 
			var node = svg.selectAll("circle")
				.data(nodes)
				.enter()
				.append("circle")
				.attr({
					class:"node",
					"r":50,
					"fill": "gray",
					"cx": function(d){ return d.coordinate_x },
					"cy": function(d){ return d.coordinate_y } 
				})
				.call(force.drag);
			
			d3.selectAll(".node").each(function(d){ d.fixed = true })
			 
			//update
			force.on("tick", function() {
				line
					.attr("x1", function(d) { return d.source.x; })
					.attr("y1", function(d) { return d.source.y; })
					.attr("x2", function(d) { return d.target.x; })
					.attr("y2", function(d) { return d.target.y; });
				node
					.attr("cx", function(d) { return d.x; })
					.attr("cy", function(d) { return d.y; });
			});
		</script>
		
	</body>
</html>